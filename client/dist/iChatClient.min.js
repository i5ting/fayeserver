function __extend(t,i){if(t||(t={}),i)for(var e in i)t[e]=i[e];return t}window.iChatClient=iChatClient=function(t){this.subs=[],this.sifter=new Sifter([]),this.debug=!0;var i=__extend({url:"http://127.0.0.1:4567/faye",timeout:120,retry:5},t);return this.client=new Faye.Client(i.url,i),this},iChatClient.prototype.log=function(t){this.debug&&console.log("[iChat LOG] "+t)},iChatClient.prototype.add=function(t){return 1==this.is_exist(t.chat_id)?void this.log("chat_id以及存在了"):(this.subs.push(t),void(this.sifter=new Sifter(this.subs)))},iChatClient.prototype.join=function(t,i){var e="/"+t;if(1==this.is_exist(t))return void this.log("chat_id以及存在了");var n=this.client.subscribe(e,i);this.add({chat_id:t,subscription:n})},iChatClient.prototype.is_exist=function(t){this.log(" chat_id = "+t);var i=this.search(t,1);return i.items.length>0?!0:!1},iChatClient.prototype.fetch=function(t,i){this.log(" chat_id = "+t);var e=this.search(t,1);if(e.items.length>0&&i){var n=this.subs[e.items[0].id];i(n)}else console.log("当前"+t+"没有订阅,无需离开")},iChatClient.prototype.search=function(t,i){this.log(" chat_id = "+t);var e=this.sifter.search(""+t,{fields:["chat_id"],sort:[{field:"chat_id",direction:"asc"}],limit:i});return e},iChatClient.prototype.leave=function(t,i){this.log(" chat_id = "+t),1==this.is_exist(t)&&this.fetch(t,function(t){var e=t.subscription;e.cancel(),i&&i()})},iChatClient.prototype.leave_all=function(t){for(var i in this.subs){var e=this.subs[i],n=(e.chat_id,e.subscription);n.cancel(),t&&t()}this.subs=[]},iChatClient.prototype.send=function(t,i,e,n){var s=this.client.publish("/"+t,i);s.then(function(){e&&e()},function(t){n&&n(t)})},iChatClient.prototype.disable_autodisconnect=function(){this.client.disable("autodisconnect")},iChatClient.prototype.disable_websocket=function(){this.client.disable("websocket")},iChatClient.prototype.disconnect=function(){this.client.disconnect()},iChatClient.prototype.reconnect=function(){};